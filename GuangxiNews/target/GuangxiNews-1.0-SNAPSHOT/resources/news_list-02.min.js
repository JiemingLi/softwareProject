$define(["wgt_util","js/pagination/initPagination","wgt_readyload","paging"],function($1,$,initPagination,r,p){var init=function(){var t=this._params,n=$compCl.getScope(t.id);pagination(t.params,n),loadFunc(t.params,n)};function imagesProcess(t,n){var a=t.isOpenCutMode?1:2,e=t.imageWidth,i=t.imageHeight;$(".p_images",n).putPhotoDiv(a,e/i),r.lazyImg({defObj:"body"})}function showComments(t,n,a,e){n&&getInfoMessageNums(e,a,t)}function titleCut(t,n,a){if(t){var e={num:n,outer:".p_header",icon:".p_icon",titleBox:".p_TitleBox"};$(".p_title .font",a).fixLineN(e),$(".p_titleA .font",a).fixLineN(e)}}function summaryCut(t,n,a){t&&$(".p_summary",a).fixLineN(n)}function titleAutoAdaption(n){n.each(function(t){$(".p_header",n).eq(t).newsAutoWidthBox("p_TitleBox")})}var paginationCallBack=function(t,n){$.ajax({url:t,type:"POST",beforeSend:function(t){},error:function(t,n,a){alert("数据加载错误 : "+a)},success:function(t){$("#c_"+n.id).html(t)}})};function getInfoMessageNums(scope,appId,commentFormat){var idAttr=[];scope.find(".p_comment").each(function(t){var n=Number($(this).attr("infoId"));idAttr.push(n)});var newsIds=idAttr.join(","),url="/message/ajax/nums",urlParam={appId:appId,id:newsIds,f:commentFormat},messageCountIcon='<i class="iconfont"></i>';$.ajax({type:"GET",url:url,data:urlParam,async:!1,success:function(data){var messageData=eval("("+data+")"),messageCountArray=messageData.data;null!=messageData&&"-1"!=messageData.code&&(null!=messageCountArray&&0<messageCountArray.length?($.each(messageCountArray,function(t,n){var a=messageCountArray[t].id,e=messageCountArray[t].format;$(".p_comment[infoId="+a+"] .font",scope).html(messageCountIcon+e)}),$(".p_comment",scope).each(function(t){""==$(this).text().trim()&&$(this).find(".font").html(messageCountIcon+0)})):scope.find(".p_comment .font").html(messageCountIcon+0))}})}function onNewsErrorImghandle(t,n){var a=t.isCheckedCustom,e=t.defaultNoPicture;1==a||"true"==a?n.find(".js_thumb").onErrorImg(e):n.find(".js_thumb").onErrorImg()}function pagination(n,a){var t=n._pagination.params.turnPageType,e=n._pagination.params.url;if("turnPage"!=t){var i={url:e,successFun:function(t){loadFunc(n,a)},turnPageType:t};"rollingLoad"==t&&(i.firstRefresh=!1),$(".p_news",a).paging(i)}else initPagination._params=n._pagination,initPagination._params.params.callback=paginationCallBack,initPagination.init()}function overAnimateHandle(t,n){var a=n.ainimateConfig;null!=a&&""!=a&&"undefined"!=a&&(a.comps=t.find(".p_articles"),$.overAnimate(a))}function coverUrlTitleHandle(t){t.find(".js_thumb").each(function(t,n){var a=$(this).parents(".p_articles").find(".js_coverUrlTitle").text().trim();$(this).attr("title",a),$(this).attr("alt",a)})}function loadFunc(t,n){var a=t.image,e=t.compConfig,i=t.appId;onNewsErrorImghandle(a,n),titleAutoAdaption(n),summaryCut(e.isAutoCutSummary,e.summaryMaxLen,n),titleCut(e.titleIntercept,e.titleShowExtendLink,n),imagesProcess(a,n),showComments(e.commentFormat,e.CommentBox,i,n),coverUrlTitleHandle(n),overAnimateHandle(n,t)}return{init:init}});